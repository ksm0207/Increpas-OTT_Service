<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="user_service">

<insert id="naver_login" parameterType="com.ott.user.vo.UserVO">
	insert into OTT_USER (u_idx, u_name, u_email, u_id, u_pwd1)
			values(OTT_USER_SEQ.nextval, #{u_name}, #{u_email}, #{u_id}, #{u_pwd1})
</insert>

<select id="user_info" resultType="com.ott.user.vo.UserVO" parameterType="String">
	select *
	from ott_user
	where u_id = #{u_id}
</select>

<select id="email_info" resultType="com.ott.user.vo.UserVO" parameterType="String">
	select *
	from ott_user
	where u_email = #{u_email}
</select>

<insert id="user_join" parameterType="com.ott.user.vo.UserVO">
	insert into OTT_USER (u_idx, u_id, u_name, u_email, u_pwd1, salt)
			values(OTT_USER_SEQ.nextval, #{u_id}, #{u_name}, #{u_email}, #{u_pwd1}, #{big_fat})
</insert>

<!-- 회원가입 시 auth_key 업데이트 -->
<update id="auth_Key" parameterType="Map">
	
		UPDATE OTT_USER
		
		SET
		auth_key = #{auth_key}
		
		WHERE u_id = #{u_id}
	
</update>

<!-- 사용자가 인증메일을 클릭했을때 mail_check 와 auth_status 
     컬럼을 1로 업데이트 해줍니다
     조건은 사용자 이메일 & auth_key를 조회한 결과가 일치했을때 입니다-->
<update id="mail_confirm" parameterType="Map">
		
		UPDATE OTT_USER
		
		SET
		 	mail_check = 1,
		 	auth_status =1
		
		WHERE u_email = #{u_email} AND auth_key = #{auth_key}
	</update>


<!-- login -->
<!-- 프로젝트 개발 테스트가 거의 끝나갈때쯤 로그인은 auth_status 가 1일 경우에 로그인 할 예정입니다 -->
<select id="login" resultType="com.ott.user.vo.UserVO"
		parameterType="Map">

		SELECT u_id, u_pwd1 
		FROM OTT_USER
		WHERE u_id = #{u_id} AND u_pwd1 = #{u_pwd1}

</select>
<!-- user_정보 -->
<select id="user_text" resultType="int" parameterType="String">
	select count(CONTENT)
	from OTT_REVIEW_BBS
	where u_idx = #{u_idx}
</select>

<insert id="user_img" parameterType="Map">
	insert into OTT_USER (u_idx, oname, fname)
			values(OTT_USER_SEQ.nextval, #{oname}, #{fname})
</insert>

</mapper>